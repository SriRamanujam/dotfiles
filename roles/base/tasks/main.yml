---
# tasks file for base

- name: Load distribution-specific variables
  include_vars: "{{ item }}"
  with_first_found:
    - "{{ ansible_distribution | lower | replace(' ', '-') }}-{{ ansible_distribution_major_version | lower }}.yml"
    - "{{ ansible_distribution | lower | replace(' ', '-') }}.yml"

- include_tasks: base.yml

- name: Bootstrap base dev tooling on mutable systems
  when: mutable_base is true
  block:
  - include_tasks: php.yml
  - include_tasks: rust.yml
  - include_tasks: python.yml
  - include_tasks: aws.yml
  - include_tasks: go.yml
  - include_tasks: hashicorp.yml
  - include_tasks: dotnet.yml
  - name: Install development tools
    become: true
    when: ansible_system == 'Linux' and mutable_base is True
    ansible.builtin.package:
      state: present
      name:
        - make
        - "{{ development_tools }}"

# Skip podman installation on WSL hosts
- include_tasks: podman.yml
  when:
    - "'microsoft' not in ansible_kernel"

- include_tasks: atuin.yml
- include_tasks: openshift.yml

# Distro-specific tasks
#- include_tasks: fedora.yml
#  when:
#    - ansible_facts['distribution'] == 'Fedora'

#- include_tasks: ubuntu.yml
#  when:
#    - ansible_facts['distribution'] == 'Ubuntu'

# Finally, deploy a mechanism to automatically run ansible-pull every couple of hours.
- include_tasks: pull.yml
