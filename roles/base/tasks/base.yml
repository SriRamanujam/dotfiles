- name: Refresh Homebrew
  when: ansible_system == 'Darwin'
  community.general.homebrew:
    upgrade_all: true

- name: Install common base set of packages
  become: true
  when: mutable_base is true
  ansible.builtin.package:
    name:
      - htop
      - neovim
      - most
      - ripgrep
      - rsync
      - tmux
      - unzip
      - "{{ xz_pkg_name }}"
      - curl
      - wget
      - "{{ netcat_pkg_name }}"
      - ca-certificates
      - ansible
      - jq
      - git
      - git-lfs
      - zip
      - "{{ p7zip_pkg_name }}"
    state: present

- name: Install common base set of packages
  when: "'fedora_variant_silverblue' in group_names"
  community.general.rpm_ostree_pkg:
    name:
      - htop
      - neovim
      - most
      - ripgrep
      - rsync
      - tmux
      - unzip
      - "{{ xz_pkg_name }}"
      - curl
      - wget
      - "{{ netcat_pkg_name }}"
      - ca-certificates
      - ansible
      - jq
      - git
      - git-lfs
      - zip
      - "{{ p7zip_pkg_name }}"
    state: present

- name: Install GNU coreutils
  when: ansible_system == 'Darwin'
  ansible.builtin.package:
    state: present
    name:
      - binutils
      - coreutils
      - gnu-tar

- name: Install SSH tools
  become: true
  when: ansible_system == 'Linux' and mutable_base is false
  ansible.builtin.package:
    state: present
    name:
      - openssh-server
      - "{{ openssh_client_pkg_name }}"

- name: Install SSH tools
  become: true
  when: "'fedora_variant_silverblue' in group_names"
  community.general.rpm_ostree_pkg:
    state: present
    name:
      - openssh-server
      - "{{ openssh_client_pkg_name }}"
