- name: Ensure dbus-run-session binary is present
  become: yes
  ansible.builtin.package:
    name:
      - "{{ dbus_run_session_package }}"
    state: latest

- name: Enable fractional scaling for GDM
  ansible.builtin.shell: dbus-run-session bash -c "dconf write /org/gnome/mutter/experimental-features \"['scale-monitor-framebuffer']\" "
  become: yes
  become_user: gdm
  become_flags: ''

- name: Drop fractional scaling configuration for GDM
  become: yes
  ansible.builtin.copy:
    src: monitors.xml
    dest: /var/lib/gdm/.config/monitors.xml
    owner: gdm
    group: gdm
    mode: '0644'

- name: Enable fractional scaling for ourselves
  ansible.builtin.command: dconf write /org/gnome/mutter/experimental-features "['scale-monitor-framebuffer']"

- name: Drop fractional scaling configuration for ourselves
  ansible.builtin.copy:
    src: monitors.xml
    dest: "{{ ansible_env.HOME }}/.config/monitors.xml"
    mode: '0644'