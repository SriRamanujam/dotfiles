---
- name: Load distribution-specific variables
  include_vars: "{{ item }}"
  with_first_found:
    - "{{ ansible_distribution | lower | replace(' ', '-') }}-{{ ansible_distribution_major_version | lower }}.yml"
    - "{{ ansible_distribution | lower | replace(' ', '-') }}.yml"

- include: scaling.yml
#- include: dmcrypt.yml
- include: pm.yml
  
- name: Configure kernel to use nvme.noacpi=1 (S0ix idle is not efficient unless this is set) (Fedora)
  ansible.builtin.command: grubby --update-kernel=ALL --args=nvme.noacpi=1
  when: "ansible_distribution == 'Fedora' and 'fedora_variant_workstation' in group_names" 

- name: Configure kernel to use nvme.noacpi=1 (S0ix idle is not efficient unless this is set) (Silverblue)
  ansible.builtin.command: rpm-ostree kargs --append='nvme.noacpi=1'
  when: "ansible_distribution == 'Fedora' and 'fedora_variant_silverblue' in group_names" 
